<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>KAFer - ログイン / 新規登録</title><link id="favicon" rel="icon" href="icon.png" type="image/png"><link rel="stylesheet" href="style.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"><link rel="manifest" href="manifest.webmanifest"><style>body{background:linear-gradient(135deg,var(--pink-shade-3) 0%,var(--pink-shade-1) 100%)}.login-card,.register-card{background-color:var(--pink-shade-2);border:1px solid var(--pink-shade-3)}.login-card .card-header,.register-card .card-header{color:var(--pink-shade-10);background-color:var(--pink-shade-1);border-bottom:1px solid var(--pink-shade-4)}.login-form-button{background-color:var(--pink-shade-7);border:1px solid var(--pink-shade-9)}.login-form-button:hover{background-color:var(--pink-shade-8)}.register-form-button{background-color:var(--pink-shade-5);border:1px solid var(--pink-shade-8)}.register-form-button:hover{background-color:var(--pink-shade-7)}input[type="text"]:focus,input[type="password"]:focus{box-shadow:0 0 0 3px var(--pink-shade-6)}.main-content-wrapper{padding-top:var(--spacing-xl);justify-content:center;align-items:center}.container{max-width:600px;padding:0}.content-section{padding:var(--spacing-xxl);background-color:var(--pink-shade-2);border:2px solid var(--pink-shade-4);box-shadow:var(--shadow-lg)}h2{color:var(--pink-shade-10);border-bottom-color:var(--pink-shade-9)}h2::after{background-color:var(--pink-shade-5)}input[type="text"],input[type="password"]{border-color:var(--pink-shade-3)}#register-form-wrapper{display:none}</style></head><body class="app-container"><header class="app-header"><div class="logo"><h1>KAFer</h1></div><div class="user-controls"></div></header><div class="main-content-wrapper"><main class="container"><div class="content-section"><h2><i class="fas fa-lock"></i> ログイン / 新規登録</h2><div id="message-area" class="message"></div><div class="card login-card"><div class="card-header">既存アカウントでログイン</div><form id="login-form"><div class="form-group"><label for="login-kaferId"><i class="fas fa-id-card"></i> KAFer ID</label><input type="text" id="login-kaferId" required pattern="[0-9]{4}" title="4桁の数字を入力してください"></div><div class="form-group"><label for="login-password"><i class="fas fa-key"></i> パスコード</label><input type="password" id="login-password" required pattern="[a-zA-Z0-9!@#$%\^&*()_+\-=\[\]{}|;:'&lt;&gt;\./?]{4,}" title="4文字以上の半角英数字記号を入力してください"></div><button type="submit" class="btn"><i class="fas fa-sign-in-alt"></i> ログイン</button></form></div><div class="card register-card" style="margin-top: var(--spacing-xl);"><div class="card-header">新規アカウント登録<button id="toggle-register-form-btn" class="btn btn-secondary" style="float: right; padding: 5px 10px; font-size: 0.9rem;"><i class="fas fa-plus"></i> 開く</button></div><div id="register-form-wrapper"><form id="register-form"><div class="form-group"><label for="register-name"><i class="fas fa-user-circle"></i> ユーザー名 (10文字以下)</label><input type="text" id="register-name" required maxlength="10" title="10文字以下のユーザー名を入力してください"></div><div class="form-group"><label for="register-kaferId"><i class="fas fa-id-card"></i> KAFer ID (4桁の数字)</label><input type="text" id="register-kaferId" required pattern="[0-9]{4}" title="4桁の数字を入力してください"></div><div class="form-group"><label for="register-password"><i class="fas fa-key"></i> パスコード (4桁以上の半角英数字記号)</label><input type="password" id="register-password" required pattern="[a-zA-Z0-9!@#$%\^&*()_+\-=\[\]{}|;:'&lt;&gt;\./?]{4,}" title="4文字以上の半角英数字記号を入力してください"></div><button type="submit" class="btn btn-secondary"><i class="fas fa-user-plus"></i> アカウント作成</button></form></div></div></div></main></div><footer class="app-footer"><p>&copy; 2025 KAFer App. All rights reserved.</p></footer><script src="crypto.js"></script><script src="global.js"></script><script>document.addEventListener('DOMContentLoaded',async()=>{initializePwaAndDarkMode();const ADMIN_ID=PROJECT_CONFIG.ADMIN_ID;const ADMIN_PASSCODE=PROJECT_CONFIG.ADMIN_PASSCODE_SPECIAL;const loginForm=document.getElementById('login-form');const registerFormWrapper=document.getElementById('register-form-wrapper');const toggleRegisterFormBtn=document.getElementById('toggle-register-form-btn');const registerForm=document.getElementById('register-form');const messageArea=document.getElementById('message-area');const urlParams=new URLSearchParams(window.location.search);const initialCode=urlParams.get('code');if(initialCode){document.getElementById('login-kaferId').value=initialCode}toggleRegisterFormBtn.addEventListener('click',()=>{const isHidden=registerFormWrapper.style.display==='none';registerFormWrapper.style.display=isHidden?'block':'none';toggleRegisterFormBtn.innerHTML=isHidden?'<i class="fas fa-minus"></i> 閉じる':'<i class="fas fa-plus"></i> 開く'});loginForm.addEventListener('submit',async e=>{e.preventDefault();hideMessage('message-area');const kaferId=document.getElementById('login-kaferId').value;const password=document.getElementById('login-password').value;if(!kaferId||!password){showMessage('message-area','KAFer IDとパスコードを入力してください。','error');return}if(!/^[0-9]{4}$/.test(kaferId)){showMessage('message-area','KAFer IDは4桁の数字を入力してください。','error');return}if(!/^[a-zA-Z0-9!@#$%\^&*()_+\-=\[\]{}|;:'&lt;&gt;\./?]{4,}$/.test(password)){showMessage('message-area','パスコードは4文字以上の半角英数字記号で入力してください。','error');return}if(kaferId===ADMIN_ID&&password===ADMIN_PASSCODE){localStorage.setItem('loggedInUser',JSON.stringify({kaferId:ADMIN_ID,name:'ADMIN',version:'v2.0',isAdmin:!0}));showMessage('message-area','管理者としてログイン成功！','success');window.location.href='admin.html';return}const loggedInUser=await authenticateUser(kaferId,password);if(loggedInUser){showMessage('message-area','ログイン成功！','success');if(loggedInUser.isAdmin){window.location.href='admin.html'}else{window.location.href='menu.html'}}else{showMessage('message-area','KAFer IDまたはパスコードが間違っています。','error')}});registerForm.addEventListener('submit',async e=>{e.preventDefault();hideMessage('message-area');const name=document.getElementById('register-name').value;const kaferId=document.getElementById('register-kaferId').value;const password=document.getElementById('register-password').value;if(!name||!kaferId||!password){showMessage('message-area','すべてのフィールドを入力してください。','error');return}if(name.length>10){showMessage('message-area','ユーザー名は10文字以下で入力してください。','error');return}if(!/^[0-9]{4}$/.test(kaferId)){showMessage('message-area','KAFer IDは4桁の数字を入力してください。','error');return}if(!/^[a-zA-Z0-9!@#$%\^&*()_+\-=\[\]{}|;:'&lt;&gt;\./?]{4,}$/.test(password)){showMessage('message-area','パスコードは4文字以上の半角英数字記号で入力してください。','error');return}const records=await fetchSheetData();const existingUser=records.find(r=>r.kaferId===kaferId&&r.type==='register');if(existingUser){showMessage('message-area','このKAFer IDは既に登録されています。','error');return}const success=await writeToSheet(name,kaferId,'register',{pass:password});if(success){showMessage('message-area','新規登録が完了しました！ログインしてください。','success');registerForm.reset();registerFormWrapper.style.display='none';toggleRegisterFormBtn.innerHTML='<i class="fas fa-plus"></i> 開く'}else{showMessage('message-area','登録に失敗しました。時間をおいて再度お試しください。','error')}})});</script></body></html>